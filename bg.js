/********************************************************************** // [파일 헤더 시작]
 * bg.js (MV3 Service Worker)                                           // 서비스 워커
 * 기능 번호 체계 반영                                                   // 번호 규칙
 * - 01-01 아이콘 클릭 → 패널 토글 메시지 전송                           // 기능 01-01
 * - 01-02 단축키(Alt+Shift+X) → 패널 토글 메시지 전송                   // 기능 01-02
 **********************************************************************/ // [파일 헤더 끝]

/********************************************************************** // [섹션 시작 05-00] 설치/업데이트 훅
 * 확장 설치/업데이트 시 1회 호출                                       // 설명
 **********************************************************************/
chrome.runtime.onInstalled.addListener(() => {         // 05-00-01
  // 초기화 필요 시 이곳 사용                                            // 05-00-02
});                                                    // 05-00-03
/********************************************************************** // [섹션 끝 05-00] 설치/업데이트 훅
 **********************************************************************/

/********************************************************************** // [섹션 시작 01-01] 아이콘 클릭 → 패널 토글
 * 현재 활성 탭의 content.js에 {type:"DOWNJSON_TOGGLE_PANEL"} 전송       // 설명
 **********************************************************************/
chrome.action.onClicked.addListener(async (tab) => {   // 01-01-01
  if (!tab || !tab.id) return;                         // 01-01-02
  try {                                                // 01-01-03
    await chrome.tabs.sendMessage(                     // 01-01-04
      tab.id,                                          // 01-01-05
      { type: "DOWNJSON_TOGGLE_PANEL" }                // 01-01-06
    );                                                 // 01-01-07
  } catch (err) {                                      // 01-01-08
    console.warn("[Downjson] 메시지 전송 실패:", err);  // 01-01-09
  }                                                    // 01-01-10
});                                                    // 01-01-11
/********************************************************************** // [섹션 끝 01-01] 아이콘 클릭 → 패널 토글
 **********************************************************************/

/********************************************************************** // [섹션 시작 01-02] 단축키 → 패널 토글
 * manifest.json commands.toggle-panel (Alt+Shift+X)                    // 설명
 **********************************************************************/
chrome.commands.onCommand.addListener(async (command) => { // 01-02-01
  if (command !== "toggle-panel") return;             // 01-02-02
  try {                                               // 01-02-03
    const [tab] = await chrome.tabs.query({           // 01-02-04
      active: true,                                   // 01-02-05
      currentWindow: true                             // 01-02-06
    });                                               // 01-02-07
    if (!tab || !tab.id) return;                      // 01-02-08
    await chrome.tabs.sendMessage(                    // 01-02-09
      tab.id,                                         // 01-02-10
      { type: "DOWNJSON_TOGGLE_PANEL" }               // 01-02-11
    );                                                // 01-02-12
  } catch (err) {                                     // 01-02-13
    console.warn("[Downjson] 단축키 메시지 실패:", err); // 01-02-14
  }                                                   // 01-02-15
});                                                   // 01-02-16
/********************************************************************** // [섹션 끝 01-02] 단축키 → 패널 토글
 **********************************************************************/
